---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import Pagination from "@components/pagination/pagination.tsx";
import getWeighins, { whereClause } from "@weight-fetcher/getWeighins.ts";
import getAllPages from "@fetcher-paginator/getAllPages.ts";
import WeightChart from '../../../components/WeightChart.tsx'

export async function getStaticPaths() {
  return await getAllPages(10, 'weighins', whereClause);
}

const {after} = Astro.props;
const {pagenum} = Astro.request.params;

const {weighins, meta} = await getWeighins(after);

const graphData = [{
  id: "weight", 
  label: "Weight", 
  data: weighins.map(w => ({x: new Date(w.weighinTime).toISOString().split('T')[0], y: w.weight}))}];
---
<BaseLayout>
  <div class="stack listing">
    <h1>Weigh Ins: Page {pagenum}</h1>
    <WeightChart client:load data={graphData} />

    {weighins.map(weighin => (
    <article class="sidebar right">
      <div>
        <div>
          <div class="h-entry stack compressed">
            <header>
              <h2>{new Date(weighin.weighinTime).toDateString()}</h2>
            </header>
            <dl>
              <dt>Weight</dt>
              <dd>
                {weighin.weight}
              </dd>
              <dt>Bodyfat</dt>
              <dd>{weighin.bodyFatPercentage}</dd>
            </dl>
            
          </div>
        </div>
      </div>
    </article>
    ))}
    <Pagination pageNumber={parseInt(pagenum, 10)} urlRoot={`/weight/page`} pageInfo={{hasNextPage: meta.hasNextPage, hasPreviousPage: meta.hasPreviousPage}} />

  </div>
</BaseLayout>
