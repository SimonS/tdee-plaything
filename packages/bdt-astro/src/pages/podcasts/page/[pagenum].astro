---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import { PodcastEntry } from '../../../components/PodcastEntry'
import Pagination from "@components/pagination/pagination";

import getPodcasts, { whereClause } from "@podcast-fetcher/getPodcasts";
import getAllPages from "@fetcher-paginator/getAllPages";

export async function getStaticPaths() {
  return await getAllPages(10, 'podcasts', whereClause);
}

const {after} = Astro.props;
const {pagenum} = Astro.params;

const {podcasts, meta} = await getPodcasts(after);

---
<BaseLayout>
  <div class="stack listing">
    <h1>Podcasts: Page {pagenum}</h1>
    
    {podcasts.map(podcast => <PodcastEntry podcast={podcast} />)}

    <Pagination tag={`a`} pageNumber={parseInt(pagenum, 10)} urlRoot={`/podcasts/page`} pageInfo={{hasNextPage: meta.hasNextPage, hasPreviousPage: meta.hasPreviousPage}} />
  </div>
</BaseLayout>
