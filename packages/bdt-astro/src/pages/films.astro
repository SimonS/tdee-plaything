---
import BaseLayout from "../layouts/BaseLayout.astro";
import FilmCalendar from "@components/interactions/films.tsx";

import getAllFilms, {
  groupFilmsByDate,
  aggregateFilms,
} from "@film-fetcher/getAllFilms.ts";

import Pagination from "@components/pagination/pagination.tsx";
import { FilmEntry } from "../components/FilmEntry.tsx";
import getFilms from "@film-fetcher/getFilms.ts";

const { films, meta } = await getFilms();

const allFilms = await getAllFilms();
const grouped = groupFilmsByDate(allFilms);
const data = aggregateFilms(grouped);
---

<BaseLayout title="Films I've seen recently">
  <div class="stack listing">
    <h1>Films</h1>
    <p>
      These are films I've watched recently, as logged in <a
        href="https://letterboxd.com/simonscarfe/">Letterboxd</a
      >.
    </p>
    <FilmCalendar client:load aggregated={data} grouped={grouped} />

    {films.map((film) => <FilmEntry film={film} />)}

    <Pagination
      tag={`a`}
      pageNumber={1}
      urlRoot={`/films/page`}
      pageInfo={{
        hasNextPage: meta.hasNextPage,
        hasPreviousPage: meta.hasPreviousPage,
      }}
    />
  </div>
</BaseLayout>
