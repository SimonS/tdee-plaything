---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import Pagination from "@components/pagination/pagination.tsx";
import getFilms, {getAllPages} from "@film-fetcher/getFilms.ts";

export async function getStaticPaths() {
  return await getAllPages(10);
}

const {after} = Astro.props;
const {pagenum} = Astro.request.params;

const {films, meta} = await getFilms(after);

---
<BaseLayout>
  <div class="stack">
    <h1>Films: Page {pagenum}</h1>
    {films.map(film => (
      <article class="sidebar right">
        <div>
          <div>
            <div class="h-entry stack compressed">
              <header>
                <h2>{film.filmTitle} ({film.year})</h2>
              </header>
              <dl>
                <dt>Viewed</dt>
                <dd>
                  <time class="dt-published" dateTime={film.watchedDate}>
                    {new Date(film.watchedDate).toDateString()}
                  </time>
                </dd>
                <dt>Rated</dt>
                <dd>{film.rating}/5</dd>
              </dl>
            {film.content && (
              <a href={film.reviewLink}>I wrote some thoughts on Letterboxd</a>
            )}
            </div>
          </div>
          <div style="max-width: 154px">
            <img src={film.meta.image} alt={`Poster for '${film.filmTitle}'`} class="poster-image" />
          </div>
        </div>
      </article>
    ))}
    <Pagination pageNumber={parseInt(pagenum, 10)} urlRoot={`/films/page`} pageInfo={{hasNextPage: meta.hasNextPage, hasPreviousPage: meta.hasPreviousPage}} />

  </div>
</BaseLayout>
