---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import Pagination from "@components/pagination/pagination.tsx";
import { FilmEntry } from "../../../components/FilmEntry.tsx";

import getFilms, { whereClause } from "@film-fetcher/getFilms.ts";
import getAllPages from "@fetcher-paginator/getAllPages.ts";

export async function getStaticPaths() {
  return await getAllPages(10, 'films', whereClause);
}

const {after} = Astro.props;
const {pagenum} = Astro.request.params;

const {films, meta} = await getFilms(after);

---
<BaseLayout>
  <div class="stack listing">
    <h1>Films: Page {pagenum}</h1>

    {films.map(film => <FilmEntry film={film} />)}

    <Pagination tag={`a`} pageNumber={parseInt(pagenum, 10)} urlRoot={`/films/page`} pageInfo={{hasNextPage: meta.hasNextPage, hasPreviousPage: meta.hasPreviousPage}} />
  </div>
</BaseLayout>
