---
import BaseLayout from '../../../layouts/BaseLayout.astro'
import MediaObject from "@components/compositions/media-object.tsx";
import Pagination from "@components/pagination/pagination.tsx";
import getFilms, {getAllPages} from "@film-fetcher/getFilms.ts";

export async function getStaticPaths() {
  return await getAllPages(10);
}

const {after} = Astro.props;
const {pagenum} = Astro.request.params;

const {films, meta} = await getFilms(after);

---
<BaseLayout>
  <div class="stack">
    <h1>Films</h1>
    {films.map(film => (
      <MediaObject imgObj={{
        src: film.meta.image,
        alt:`Poster for '${film.filmTitle}'`
      }}>
        <header>
          <h2>{film.filmTitle} ({film.year})</h2>
        </header>
        <dl>
          <dt>Viewed</dt>
          <dd>
            <time className="dt-published" dateTime={film.watchedDate}>
              {new Date(film.watchedDate).toDateString()}
            </time>
          </dd>
          <dt>Rated</dt>
          <dd>{film.rating}/5</dd>
        </dl>
        {film.content && (
          <a href={film.reviewLink}>I wrote some thoughts on Letterboxd</a>
        )}
      </MediaObject>
    ))}
    <Pagination pageNumber={parseInt(pagenum, 10)} urlRoot={`/films/page`} pageInfo={{hasNextPage: meta.hasNextPage, hasPreviousPage: meta.hasPreviousPage}} />

  </div>
</BaseLayout>
