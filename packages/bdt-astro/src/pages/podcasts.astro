---
import BaseLayout from '../layouts/BaseLayout.astro'
import Pagination from "@components/pagination/pagination.tsx";
import getPodcasts from "@podcast-fetcher/getPodcasts.ts";

const {podcasts, meta} = await getPodcasts();
---

<BaseLayout title="Podcasts I've been listening to">
  <div class="stack">
    <h1>Podcasts</h1>
    <p>These are the podcasts I've recently heard, it's all aggregated from <a href="https://overcast.fm">Overcast</a>.</p>
    {podcasts.map(podcast => (
    <article class="sidebar right">
      <div>
        <div>
          <div class="h-entry stack compressed">
            <header>
              <h2>{podcast.podcastTitle}</h2>
            </header>
            <dl>
              <dt>Listened</dt>
              <dd>
                <time class="dt-published" dateTime={podcast.listenDate}>
                  {new Date(podcast.listenDate).toDateString()}
                </time>
              </dd>
              <dt>Podcast</dt>
              <dd><a href={podcast.episodeURL}>{podcast.feedTitle}</a></dd>
            </dl>      
          </div>
        </div>
        <div style="max-width: 154px">
          <img src={podcast.feedImage} alt={podcast.feedTitle} class="poster-image" />
        </div>
      </div>
    </article>
    ))}
    <Pagination pageNumber={1} urlRoot={`/podcasts/page`} pageInfo={{hasNextPage: meta.hasNextPage, hasPreviousPage: meta.hasPreviousPage}} />
  </div>
</BaseLayout>
    